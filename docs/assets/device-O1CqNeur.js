import{j as e,e as z,r as g,x as j,D as v,E as C,M as p,F as U,B as P,y as N,L as q,z as T,G as R,H as G,t as I,I as d}from"./heroui-BBt1nr5R.js";import{u as H,b as k,R as M,N as _,D as w,L as J}from"./index-p8QqIDKq.js";import{V as i,u as h,M as y,m as E,R as F}from"./mqtt-BfWkePb-.js";import{u as K,V as b,c as D,a as W,b as S,d as Q,e as Y,E as X}from"./validated-text-field-82D8fbOM.js";import{b as Z,f as A,B,c as ee,P as se,V as te,I as ne,g as ae}from"./lucide-react-CZTpUkPQ.js";function V(s){return H({...s,select:n=>s.select?s.select(n.context):n.context})}const re="/iot-commander/assets/chip-CyMWBy1t.svg";function O({variable:s,value:n,className:a,...l}){return e.jsxs("div",{className:z("flex flex-col mb-[0.3rem] md:flex-row md:gap-[0.5rem] md:mb-0",a),...l,children:[e.jsxs("div",{className:"flex flex-1 justify-between items-center gap-[0.7rem]",children:[e.jsxs("div",{className:"flex gap-[0.5rem]",children:[e.jsxs("div",{className:"flex text-[12pt] text-accent gap-[0.5rem]",children:[e.jsxs("div",{className:"flex",children:[s.type," "]}),s.type===i.ENUM&&s.enumDefinition?e.jsxs("div",{className:"flex",children:["(",s.enumDefinition.join(", "),")"]}):null]}),e.jsx("div",{className:"flex text-[12pt] opacity-80",children:s.name})]}),e.jsx("div",{className:"flex h-[1px] flex-1 bg-separator"})]}),n?e.jsx("div",{className:"flex items-center text-[12pt] break-all",children:n}):null]})}function $(){const{t:s}=h();return e.jsxs("div",{className:"flex items-center gap-[1rem] opacity-70",children:[e.jsx(Z,{className:"text-accent size-[1.5rem]"}),e.jsx("div",{className:"flex text-accent font-medium",children:s("empty")})]})}function ce({action:s}){const{t:n}=h(),{connectionData:a}=g.useContext(y),{device:l}=V({from:"/device"});if(!a||!l)throw new Error("Missing data");const{data:c,isLoading:x}=k({queryKey:["ACTION_AUTO_FETCH",s.name],queryFn:async()=>{const t=await E({client:a.client,requestTopic:l.requestTopic,responseTopic:l.responseTopic,action:s.name,parameters:{}});if(t.status===F.ERROR)throw new Error(t.code);return console.log("res",t.results),t.results}});return x||!c?e.jsx(j,{children:e.jsxs(j.Content,{className:"gap-[1rem]",children:[e.jsx(v,{className:"h-3 w-1/2 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"})]})}):e.jsx(j,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(j.Content,{children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(A,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(B,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("results")})]}),e.jsx(C,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results.length?s.results.map((t,r)=>e.jsx(O,{variable:t,value:c[t.name]!==void 0?JSON.stringify(c[t.name]):"N/A"},`${t.name}-${r}`)):e.jsx($,{})})]})})}function ie(s){const n={};for(const a of s.parameters)switch(a.type){case i.INT:n[a.name]="";break;case i.FLOAT:n[a.name]="";break;case i.DOUBLE:n[a.name]="";break;case i.BOOL:n[a.name]=!1;break;case i.STRING:n[a.name]="";break;case i.ENUM:n[a.name]="";break}return n}function le(s){const n={};for(const a of s.parameters)switch(a.type){case i.INT:n[a.name]=S().integer().required();break;case i.FLOAT:n[a.name]=S().required();break;case i.DOUBLE:n[a.name]=S().required();break;case i.BOOL:n[a.name]=W();break;case i.STRING:n[a.name]=D().required();break;case i.ENUM:a.enumDefinition&&(n[a.name]=D().oneOf([...a.enumDefinition]).required());break}return Q(n)}function f({parameter:s}){return e.jsxs("span",{children:[e.jsx("span",{className:"mr-[0.3rem] text-accent",children:s.type}),e.jsx("span",{children:s.name})]})}function oe({state:s,action:n,onSubmit:a}){const{t:l}=h(),c=K({initialValues:ie(n),validationSchema:le(n),onSubmit(t){a(t)}});function x(){return n.parameters.map((t,r)=>{switch(t.type){case i.INT:return e.jsx(b,{formik:c,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"1"}},`${t.name}-${r}`);case i.FLOAT:return e.jsx(b,{formik:c,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"0.01"}},`${t.name}-${r}`);case i.DOUBLE:return e.jsx(b,{formik:c,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"0.01"}},`${t.name}-${r}`);case i.BOOL:return e.jsxs(R,{isSelected:c.values[t.name],onChange:m=>c.setFieldValue(t.name,m),children:[e.jsx(R.Control,{children:e.jsx(R.Thumb,{})}),e.jsx(q,{className:"text-sm",children:e.jsx(f,{parameter:t})})]},`${t.name}-${r}`);case i.STRING:return e.jsx(b,{formik:c,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})}},`${t.name}-${r}`);case i.ENUM:if(t.enumDefinition)return e.jsxs(N,{isInvalid:c.errors[t.name]!==void 0,value:c.values[t.name],onChange:m=>c.setFieldValue(t.name,m?.toString()),children:[e.jsx(q,{children:e.jsx(f,{parameter:t})}),e.jsxs(N.Trigger,{children:[e.jsx(N.Value,{}),e.jsx(N.Indicator,{})]}),e.jsx(N.Popover,{children:e.jsx(T,{children:t.enumDefinition.map(m=>e.jsxs(T.Item,{id:m,textValue:m,children:[m,e.jsx(T.ItemIndicator,{})]},m))})}),c.errors[t.name]?e.jsx("div",{className:"ml-[0.3rem] text-danger text-[9pt]",children:c.errors[t.name]}):null]},`${t.name}-${r}`)}})}return e.jsx(p.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(p.Container,{placement:"center",children:e.jsxs(p.Dialog,{children:[e.jsx(p.CloseTrigger,{}),e.jsxs(p.Header,{children:[e.jsx(p.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(ee,{name:"variable",className:"size-5"})}),e.jsx(p.Heading,{children:l("parameters")})]}),e.jsx(p.Body,{className:"p-[0.3rem]",children:e.jsxs(U,{onSubmit:c.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[x(),e.jsx(P,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:l("send")})]})})]})})})}function me({action:s}){const{t:n}=h(),{connectionData:a}=g.useContext(y),{device:l}=V({from:"/device"}),c=G(),[x,t]=g.useState({});if(!a||!l)throw new Error("Missing data");const{mutate:r,isPending:m}=Y({mutationFn:async o=>{const u=await E({client:a.client,requestTopic:l.requestTopic,responseTopic:l.responseTopic,action:s.name,parameters:o});if(u.status===F.ERROR)throw new Error(u.code);return console.log("res",u.results),u.results},onSuccess(o){t(o),I(n("actionSuccess"),{indicator:e.jsx(ae,{}),variant:"success"})},onError(o){I(`${n("error")}: ${o.code}`,{indicator:e.jsx(ne,{}),variant:"danger"})}});return e.jsxs(e.Fragment,{children:[s.parameters.length?e.jsx(oe,{state:c,action:s,onSubmit:o=>{r(o),c.close()}}):null,e.jsx(j,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(j.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(A,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsx(P,{isIconOnly:!0,variant:"primary",isPending:m,style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 30%) 0 0 3rem 0"},onPress:()=>{s.parameters.length?c.open():r({})},children:e.jsx(se,{})})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(te,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("parameters")})]}),e.jsx(C,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.parameters.length?s.parameters.map((o,u)=>e.jsx(O,{variable:o},`${o.name}-${u}`)):e.jsx($,{})}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(B,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("results")})]}),e.jsx(C,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results.length?s.results.map((o,u)=>e.jsx(O,{variable:o,value:x[o.name]?JSON.stringify(x[o.name]):"N/A"},`${o.name}-${u}`)):e.jsx($,{})})]})})]})}function L(){const{t:s}=h();return e.jsxs("div",{className:"flex flex-col gap-[1rem] items-center py-[3rem]",children:[e.jsx("img",{src:X,alt:"empty",className:"h-[10rem]"}),e.jsx("div",{className:"flex uppercase font-bold text-[20pt] doto-font",children:s("empty")})]})}function xe(){const{t:s}=h(),{connectionData:n}=g.useContext(y),{device:a}=M.useRouteContext();if(!n||!a)throw new Error("Missing data");const{data:l,isLoading:c}=k({queryKey:["SCHEMA"],queryFn:async()=>{const r=await E({client:n.client,requestTopic:a.requestTopic,responseTopic:a.responseTopic,action:"__SCHEMA__",parameters:{}});if(console.log("res",r),r.status===F.ERROR)throw new Error(r.code);return r.results.actions}});if(c||!l)return e.jsx(J,{});const x=l.filter(r=>r.autoFetch),t=l.filter(r=>!r.autoFetch);return e.jsxs(d,{className:"mt-[3rem]",children:[e.jsx(d.ListContainer,{children:e.jsxs(d.List,{"aria-label":"Options",children:[e.jsxs(d.Tab,{id:"auto-fetch",children:[s("autoFetch"),e.jsx(d.Indicator,{})]}),e.jsxs(d.Tab,{id:"manual-fetch",children:[s("manual"),e.jsx(d.Indicator,{})]})]})}),e.jsx(d.Panel,{className:"pt-4",id:"auto-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:x.length?x.map((r,m)=>e.jsx(ce,{action:r},`${r.name}-${m}`)):e.jsx(L,{})})}),e.jsx(d.Panel,{className:"pt-4",id:"manual-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:t.length?t.map((r,m)=>e.jsx(me,{action:r},`${r.name}-${m}`)):e.jsx(L,{})})})]})}function he(){const{connectionData:s}=g.useContext(y),{device:n}=M.useRouteContext();return!s||!n?e.jsx(_,{to:"/"}):e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full px-[1rem] pb-[5rem]",children:[e.jsxs("div",{className:"flex flex-col pt-[5rem] pb-[2rem] gap-[2rem]",children:[e.jsxs("div",{className:"flex relative justify-center items-center",children:[e.jsx("img",{src:re,alt:"chip",className:"h-[7rem] z-10"}),e.jsx("div",{className:"flex absolute h-[10rem] w-[15rem] rounded-full bg-accent blur-2xl opacity-20"})]}),e.jsx("div",{className:"flex justify-center font-bold text-[20pt] z-10 doto-font",children:n.name})]}),e.jsx(j,{children:e.jsxs(j.Content,{children:[e.jsx(w,{name:"ID",value:n.id}),e.jsx(w,{name:"Request topic",value:n.requestTopic}),e.jsx(w,{name:"Response topic",value:n.responseTopic})]})}),e.jsx(xe,{})]})})}export{he as component};
