import{j as e,x as c,r as i,B as h,v as y}from"./heroui-BBt1nr5R.js";import{i as N,j as u,D as d}from"./index-3XTUXldt.js";import{u as f,M as j,v as D,c as b}from"./mqtt-BJlUnQ8k.js";import{S as T}from"./section-header-CmMK927m.js";import{E as S}from"./empty-CthHXiu9.js";import{j as C,i as E}from"./lucide-react-BlfHtPbk.js";const R="/iot-commander/assets/server-Dxd8r4DZ.svg";function a({device:n}){const s=N(),r=u();return e.jsxs(c,{className:"hover:border-accent cursor-pointer duration-200 transition-colors",onClick:()=>{s.update({context:{device:n}}),r({to:"/device"})},children:[e.jsx(C,{"aria-label":"Dollar sign icon",className:"text-primary size-6",role:"img"}),e.jsx(c.Header,{children:e.jsx(c.Title,{children:n.name})}),e.jsxs(c.Content,{children:[e.jsx(d,{name:"ID",value:n.id,fold:!0}),e.jsx(d,{name:"Request topic",value:n.requestTopic,fold:!0}),e.jsx(d,{name:"Response topic",value:n.responseTopic,fold:!0})]})]})}function $(){const{t:n}=f(),{connectionData:s}=i.useContext(j);if(!s)throw new Error("No connection");const[r,v]=i.useState([]);return i.useEffect(()=>{s.client.subscribe(s.info.responseDiscoveryTopic);const t=(o,g)=>{try{const l=g.toString(),m=JSON.parse(l);console.log(m),v(x=>x.find(p=>p.id===m.id)?x:[...x.map(p=>({...p})),m])}catch(l){console.error(l)}};return s.client.on("message",t),()=>{s.client.removeListener("message",t),s.client.unsubscribe(s.info.responseDiscoveryTopic)}},[s.client,s.info.responseDiscoveryTopic]),i.useEffect(()=>{const t={requestId:D(),type:b.REQUEST,action:"__DISCOVERY__",parameters:{}};s.client.publish(s.info.discoveryTopic,JSON.stringify(t))},[s.client,s.info.discoveryTopic]),e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(T,{icon:"cpu",children:n("devices")}),e.jsx(y,{color:"accent",size:"lg"})]}),r.length?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-[1rem] p-[1rem] pb-[5rem]",children:[r.map((t,o)=>e.jsx(a,{device:t},`${t.id}-${o}`)),r.map((t,o)=>e.jsx(a,{device:t},`${t.id}-${o}`)),r.map((t,o)=>e.jsx(a,{device:t},`${t.id}-${o}`)),r.map((t,o)=>e.jsx(a,{device:t},`${t.id}-${o}`))]}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:S,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:n("noDevices.title")}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:n("noDevices.subTitle")})]})]})})}function O(){const{t:n}=f(),{connectionData:s}=i.useContext(j),r=u();return s?e.jsx($,{}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:R,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:n("disconnected")}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:n("noConnections.subTitle")}),e.jsxs(h,{variant:"primary",onPress:()=>r({to:"/connections"}),children:[e.jsx(E,{}),n("connect")]})]})}export{O as component};
