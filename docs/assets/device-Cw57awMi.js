import{j as e,e as D,r as h,x,D as f,E as y,M as m,F as P,B as $,y as u,L as F,z as N,G as g,H as M,I as o}from"./heroui-BBt1nr5R.js";import{u as I,b as q,R as E,N as L,D as b,L as k}from"./index-3XTUXldt.js";import{V as c,M as j,m as C,R as w}from"./mqtt-BJlUnQ8k.js";import{b as A,V,P as B}from"./lucide-react-BlfHtPbk.js";import{u as U,V as p,c as O,a as H,b as v,d as _,e as z}from"./validated-text-field-DYFUzoG0.js";function S(a){return I({...a,select:t=>a.select?a.select(t.context):t.context})}const G="/iot-commander/assets/chip-CyMWBy1t.svg";function R({variable:a,value:t,className:s,...l}){return e.jsxs("div",{className:D("flex flex-col mb-[0.3rem] md:flex-row md:gap-[0.5rem] md:mb-0",s),...l,children:[e.jsxs("div",{className:"flex flex-1 justify-between items-center gap-[0.7rem]",children:[e.jsxs("div",{className:"flex gap-[0.5rem]",children:[e.jsxs("div",{className:"flex text-[12pt] text-accent gap-[0.5rem]",children:[e.jsxs("div",{className:"flex",children:[a.type," "]}),a.type===c.ENUM&&a.enumDefinition?e.jsxs("div",{className:"flex",children:["(",a.enumDefinition.join(", "),")"]}):null]}),e.jsx("div",{className:"flex text-[12pt] opacity-80",children:a.name})]}),e.jsx("div",{className:"flex h-[1px] flex-1 bg-separator"})]}),t?e.jsx("div",{className:"flex items-center text-[12pt] break-all",children:t}):null]})}function T(){return e.jsxs("div",{className:"flex items-center gap-[1rem] opacity-70",children:[e.jsx(A,{className:"text-accent size-[1.5rem]"}),e.jsx("div",{className:"flex text-accent font-medium",children:"Empty"})]})}function K({action:a}){const{connectionData:t}=h.useContext(j),{device:s}=S({from:"/device"});if(!t||!s)throw new Error("Missing data");const{data:l,isLoading:r}=q({queryKey:["ACTION_AUTO_FETCH",a.name],queryFn:async()=>{const i=await C({client:t.client,requestTopic:s.requestTopic,responseTopic:s.responseTopic,action:a.name,parameters:{}});if(i.status===w.ERROR)throw new Error(i.code);return console.log("res",i.results),i.results}});return r||!l?e.jsx(x,{children:e.jsxs(x.Content,{className:"gap-[1rem]",children:[e.jsx(f,{className:"h-3 w-1/2 rounded-lg"}),e.jsx(f,{className:"h-3 rounded-lg"}),e.jsx(f,{className:"h-3 rounded-lg"}),e.jsx(f,{className:"h-3 rounded-lg"})]})}):e.jsx(x,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(x.Content,{children:[e.jsx("div",{className:"flex text-[13pt] font-bold",children:a.name}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Results"}),e.jsx(y,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:a.results.length?a.results.map((i,n)=>e.jsx(R,{variable:i,value:l[i.name]!==void 0?JSON.stringify(l[i.name]):"N/A"},`${i.name}-${n}`)):e.jsx(T,{})})]})})}function W(a){const t={};for(const s of a.parameters)switch(s.type){case c.INT:t[s.name]=0;break;case c.FLOAT:t[s.name]=0;break;case c.DOUBLE:t[s.name]=0;break;case c.BOOL:t[s.name]=!1;break;case c.STRING:t[s.name]="";break;case c.ENUM:t[s.name]="";break}return t}function J(a){const t={};for(const s of a.parameters)switch(s.type){case c.INT:t[s.name]=v().integer().required();break;case c.FLOAT:t[s.name]=v().required();break;case c.DOUBLE:t[s.name]=v().required();break;case c.BOOL:t[s.name]=H();break;case c.STRING:t[s.name]=O().required();break;case c.ENUM:s.enumDefinition&&(t[s.name]=O().oneOf([...s.enumDefinition]).required());break}return _(t)}function Q({state:a,action:t}){const s=U({initialValues:W(t),validationSchema:J(t),onSubmit(r){console.log(r)}});function l(){return t.parameters.map((r,i)=>{switch(r.type){case c.INT:return e.jsx(p,{formik:s,name:r.name,textFieldProps:{isRequired:!0},labelProps:{children:r.name},inputProps:{type:"number",onChange:n=>s.setFieldValue(r.name,Number(n.target.value))}},`${r.name}-${i}`);case c.FLOAT:return e.jsx(p,{formik:s,name:r.name,textFieldProps:{isRequired:!0},labelProps:{children:r.name},inputProps:{type:"number",onChange:n=>s.setFieldValue(r.name,Number(n.target.value))}},`${r.name}-${i}`);case c.DOUBLE:return e.jsx(p,{formik:s,name:r.name,textFieldProps:{isRequired:!0},labelProps:{children:r.name},inputProps:{type:"number",onChange:n=>s.setFieldValue(r.name,Number(n.target.value))}},`${r.name}-${i}`);case c.BOOL:return e.jsxs(g,{isSelected:s.values[r.name],onChange:n=>s.setFieldValue(r.name,n),children:[e.jsx(g.Control,{children:e.jsx(g.Thumb,{})}),e.jsx(F,{className:"text-sm",children:"Enable notifications"})]},`${r.name}-${i}`);case c.STRING:return e.jsx(p,{formik:s,name:r.name,textFieldProps:{isRequired:!0},labelProps:{children:r.name}},`${r.name}-${i}`);case c.ENUM:if(r.enumDefinition)return e.jsxs(u,{value:s.values[r.name],onChange:n=>s.setFieldValue(r.name,n?.toString()),children:[e.jsx(F,{children:r.name}),e.jsxs(u.Trigger,{children:[e.jsx(u.Value,{}),e.jsx(u.Indicator,{})]}),e.jsx(u.Popover,{children:e.jsx(N,{children:r.enumDefinition.map(n=>e.jsxs(N.Item,{id:n,textValue:n,children:[n,e.jsx(N.ItemIndicator,{})]},n))})})]},`${r.name}-${i}`)}})}return e.jsx(m.Backdrop,{isOpen:a.isOpen,onOpenChange:a.setOpen,variant:"blur",children:e.jsx(m.Container,{placement:"center",children:e.jsxs(m.Dialog,{children:[e.jsx(m.CloseTrigger,{}),e.jsxs(m.Header,{children:[e.jsx(m.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(V,{className:"size-5"})}),e.jsx(m.Heading,{children:"Parameters"})]}),e.jsx(m.Body,{className:"p-[0.3rem]",children:e.jsxs(P,{onSubmit:s.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[l(),e.jsx($,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:"Request"})]})})]})})})}function Y({action:a}){const{connectionData:t}=h.useContext(j),{device:s}=S({from:"/device"}),l=M();if(!t||!s)throw new Error("Missing data");const{mutate:r,isPending:i}=z({mutationFn:async()=>{const n=await C({client:t.client,requestTopic:s.requestTopic,responseTopic:s.responseTopic,action:a.name,parameters:{}});if(n.status===w.ERROR)throw new Error(n.code);return console.log("res",n.results),n.results}});return e.jsxs(e.Fragment,{children:[a.parameters.length?e.jsx(Q,{state:l,action:a}):null,e.jsx(x,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(x.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex text-[13pt] font-bold pb-[1rem]",children:a.name}),e.jsx($,{isIconOnly:!0,variant:"primary",isPending:i,style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 30%) 0 0 3rem 0"},onPress:()=>{a.parameters.length?l.open():r()},children:e.jsx(B,{})})]}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Parameters"}),e.jsx(y,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:a.parameters.length?a.parameters.map((n,d)=>e.jsx(R,{variable:n},`${n.name}-${d}`)):e.jsx(T,{})}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Results"}),e.jsx(y,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:a.results.length?a.results.map((n,d)=>e.jsx(R,{variable:n,value:"N/A"},`${n.name}-${d}`)):e.jsx(T,{})})]})})]})}function X(){const{connectionData:a}=h.useContext(j),{device:t}=E.useRouteContext();if(!a||!t)throw new Error("Missing data");const{data:s,isLoading:l}=q({queryKey:["SCHEMA"],queryFn:async()=>{const n=await C({client:a.client,requestTopic:t.requestTopic,responseTopic:t.responseTopic,action:"__SCHEMA__",parameters:{}});if(console.log("res",n),n.status===w.ERROR)throw new Error(n.code);return n.results.actions}});if(l||!s)return e.jsx(k,{});const r=s.filter(n=>n.autoFetch),i=s.filter(n=>!n.autoFetch);return e.jsxs(o,{className:"mt-[1rem]",children:[e.jsx(o.ListContainer,{children:e.jsxs(o.List,{"aria-label":"Options",children:[e.jsxs(o.Tab,{id:"auto-fetch",children:["Auto-fetch",e.jsx(o.Indicator,{})]}),e.jsxs(o.Tab,{id:"manual-fetch",children:["Manual",e.jsx(o.Indicator,{})]})]})}),e.jsx(o.Panel,{className:"pt-4",id:"auto-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:r.map((n,d)=>e.jsx(K,{action:n},`${n.name}-${d}`))})}),e.jsx(o.Panel,{className:"pt-4",id:"manual-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:i.map((n,d)=>e.jsx(Y,{action:n},`${n.name}-${d}`))})})]})}function ae(){const{connectionData:a}=h.useContext(j),{device:t}=E.useRouteContext();return!a||!t?e.jsx(L,{to:"/"}):e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full px-[1rem] pb-[5rem]",children:[e.jsxs("div",{className:"flex flex-col pt-[5rem] pb-[2rem] gap-[2rem]",children:[e.jsxs("div",{className:"flex relative justify-center items-center",children:[e.jsx("img",{src:G,alt:"chip",className:"h-[7rem] z-10"}),e.jsx("div",{className:"flex absolute h-[10rem] w-[15rem] rounded-full bg-accent blur-2xl opacity-20"})]}),e.jsx("div",{className:"flex justify-center font-bold text-[20pt] z-10",style:{fontFamily:"Doto"},children:t.name})]}),e.jsx(x,{children:e.jsxs(x.Content,{children:[e.jsx(b,{name:"ID",value:t.id}),e.jsx(b,{name:"Request topic",value:t.requestTopic}),e.jsx(b,{name:"Response topic",value:t.responseTopic})]})}),e.jsx(X,{})]})})}export{ae as component};
