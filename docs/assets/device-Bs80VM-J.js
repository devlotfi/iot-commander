import{j as e,D as B,e as J,r as b,x as p,E as v,B as q,F,M as j,G as Y,H as y,I as T,J as D,K as S,y as N,L as V,z as w,N as $,O as g,Q as W,t as M,U as d}from"./heroui-CxA_KB6w.js";import{u as X,b as z,R as G,N as Z,D as E,L as ee}from"./index-Dwnbr_lc.js";import{V as i,u as f,M as O,m as U,R as I,c as se}from"./mqtt-CQkWiMLD.js";import{u as ne,V as C,c as k,a as ae,b as R,d as re,e as te,E as le}from"./validated-text-field-UMCcPxtt.js";import{b as ie,f as H,R as ce,B as _,c as oe,P as Q,V as me,I as xe,g as de}from"./lucide-react-DOKIJRMn.js";function K(s){return X({...s,select:a=>s.select?s.select(a.context):a.context})}const ue="/iot-commander/assets/chip-f2sgRaXO.svg";function L({value:s,valueData:a,className:r,...t}){return e.jsxs("div",{className:J("flex flex-col mb-[0.3rem] md:flex-row md:gap-[0.5rem] md:mb-0",r),...t,children:[e.jsxs("div",{className:"flex flex-1 justify-between items-center gap-[0.7rem]",children:[e.jsxs("div",{className:"flex gap-[0.5rem]",children:[e.jsxs("div",{className:"flex text-[12pt] text-accent gap-[0.5rem]",children:[e.jsxs("div",{className:"flex",children:[s.type," "]}),s.type===i.RANGE?e.jsxs("div",{className:"flex",children:["[",s.min," , ",s.max,"]"]}):null,s.type===i.ENUM&&s.enumDefinition?e.jsxs("div",{className:"flex",children:["(",s.enumDefinition.join(", "),")"]}):null]}),e.jsx("div",{className:"flex text-[12pt] opacity-80",children:s.name})]}),e.jsx("div",{className:"flex h-[1px] flex-1 bg-separator"})]}),a!==void 0?e.jsx("div",{className:"flex items-center text-[12pt] break-all",children:typeof a=="string"?a:JSON.stringify(a)}):null,s.type===i.COLOR&&a?e.jsx(B,{"aria-label":"color",color:a,size:"sm"}):null]})}function P(){const{t:s}=f();return e.jsxs("div",{className:"flex items-center gap-[1rem] opacity-60",children:[e.jsx(ie,{className:"size-[1.5rem]"}),e.jsx("div",{className:"flex font-medium",children:s("empty")})]})}function je({query:s}){const{t:a}=f(),{connectionData:r}=b.useContext(O),{device:t}=K({from:"/device"});if(!r||!t)throw new Error("Missing data");const{data:l,isLoading:o,refetch:n,isRefetching:x}=z({queryKey:["QUERY",s.name],queryFn:async()=>{const c=await U({client:r.client,requestTopic:t.requestTopic,responseTopic:t.responseTopic,query:s.name});if(c.status===I.ERROR)throw new Error(c.code);return console.log("res",c.results),c.results}});return o||!l?e.jsx(p,{children:e.jsxs(p.Content,{className:"gap-[1rem]",children:[e.jsx(v,{className:"h-3 w-1/2 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"})]})}):e.jsx(p,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(p.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(H,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsx(q,{isIconOnly:!0,variant:"outline",className:"bg-[color-mix(in_srgb,var(--surface),transparent_80%)]",isPending:x,onPress:()=>n(),children:e.jsx(ce,{})})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(_,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:a("results")})]}),e.jsx(F,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results.length?s.results.map((c,m)=>e.jsx(L,{value:c,valueData:l[c.name]},`${c.name}-${m}`)):e.jsx(P,{})})]})})}function he(s){if(!s.parameters)return{};const a={};for(const r of s.parameters)switch(r.type){case i.INT:a[r.name]="";break;case i.RANGE:a[r.name]="";break;case i.FLOAT:a[r.name]="";break;case i.DOUBLE:a[r.name]="";break;case i.BOOL:a[r.name]=!1;break;case i.STRING:a[r.name]="";break;case i.ENUM:a[r.name]="";break;case i.COLOR:a[r.name]="#ffffff";break}return a}function pe(s){if(!s.parameters)return{};const a={};for(const r of s.parameters){let t;switch(r.type){case i.INT:t=R().integer();break;case i.RANGE:t=R().integer().min(r.min||0).max(r.max||0);break;case i.FLOAT:t=R();break;case i.DOUBLE:t=R();break;case i.BOOL:t=ae();break;case i.STRING:t=k();break;case i.ENUM:r.enumDefinition&&(t=k().oneOf([...r.enumDefinition]).required());break;case i.COLOR:t=k();break}t&&(a[r.name]=r.required?t.required():t)}return re(a)}function h({parameter:s}){return e.jsxs("span",{children:[e.jsx("span",{className:"mr-[0.3rem] text-accent",children:s.type}),e.jsx("span",{children:s.name})]})}function fe({state:s,action:a,onSubmit:r}){const{t}=f(),l=ne({initialValues:he(a),validationSchema:pe(a),onSubmit(n){r(n)}});function o(){if(a.parameters)return a.parameters.map((n,x)=>{switch(n.type){case i.INT:return e.jsx(C,{formik:l,name:n.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(h,{parameter:n})},inputProps:{type:"number",step:"1"}},`${n.name}-${x}`);case i.RANGE:return e.jsxs(g,{"aria-label":"slider",minValue:n.min,maxValue:n.max,value:+l.values[n.name],onChange:c=>l.setFieldValue(n.name,c),children:[e.jsx(h,{parameter:n}),e.jsx(g.Output,{}),e.jsxs(g.Track,{children:[e.jsx(g.Fill,{}),e.jsx(g.Thumb,{})]})]},`${n.name}-${x}`);case i.FLOAT:return e.jsx(C,{formik:l,name:n.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(h,{parameter:n})},inputProps:{type:"number",step:"0.01"}},`${n.name}-${x}`);case i.DOUBLE:return e.jsx(C,{formik:l,name:n.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(h,{parameter:n})},inputProps:{type:"number",step:"0.01"}},`${n.name}-${x}`);case i.BOOL:return e.jsxs($,{isSelected:l.values[n.name],onChange:c=>l.setFieldValue(n.name,c),children:[e.jsx($.Control,{children:e.jsx($.Thumb,{})}),e.jsx(V,{className:"text-sm",children:e.jsx(h,{parameter:n})})]},`${n.name}-${x}`);case i.STRING:return e.jsx(C,{formik:l,name:n.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(h,{parameter:n})}},`${n.name}-${x}`);case i.ENUM:if(n.enumDefinition)return e.jsxs(N,{isInvalid:l.errors[n.name]!==void 0,value:l.values[n.name],onChange:c=>l.setFieldValue(n.name,c?.toString()),children:[e.jsx(V,{children:e.jsx(h,{parameter:n})}),e.jsxs(N.Trigger,{children:[e.jsx(N.Value,{}),e.jsx(N.Indicator,{})]}),e.jsx(N.Popover,{children:e.jsx(w,{children:n.enumDefinition.map(c=>e.jsxs(w.Item,{id:c,textValue:c,children:[c,e.jsx(w.ItemIndicator,{})]},c))})}),l.errors[n.name]?e.jsx("div",{className:"ml-[0.3rem] text-danger text-[9pt]",children:l.errors[n.name]}):null]},`${n.name}-${x}`);break;case i.COLOR:return e.jsxs(y,{"aria-label":"color",value:l.values[n.name],onChange:c=>l.setFieldValue(n.name,c?.toString("hex")),children:[e.jsx(h,{parameter:n}),e.jsxs(y.Group,{children:[e.jsx(y.Prefix,{children:e.jsxs(T,{value:l.values[n.name],onChange:c=>l.setFieldValue(n.name,c?.toString("hex")),children:[e.jsx(T.Trigger,{children:e.jsx(B,{size:"sm"})}),e.jsxs(T.Popover,{className:"gap-2",children:[e.jsx(D,{"aria-label":"Color area",className:"max-w-full",colorSpace:"hsb",xChannel:"saturation",yChannel:"brightness",children:e.jsx(D.Thumb,{})}),e.jsx(S,{"aria-label":"Hue slider",channel:"hue",className:"flex-1",colorSpace:"hsb",children:e.jsx(S.Track,{children:e.jsx(S.Thumb,{})})})]})]})}),e.jsx(y.Input,{})]})]},`${n.name}-${x}`)}})}return e.jsx(j.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(j.Container,{placement:"center",children:e.jsxs(j.Dialog,{children:[e.jsx(j.CloseTrigger,{}),e.jsxs(j.Header,{children:[e.jsx(j.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(oe,{name:"variable",className:"size-5"})}),e.jsx(j.Heading,{children:t("parameters")})]}),e.jsx(j.Body,{className:"p-[0.3rem]",children:e.jsxs(Y,{onSubmit:l.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[o(),e.jsxs(q,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:[t("send"),e.jsx(Q,{})]})]})})]})})})}function Ne({action:s}){const{t:a}=f(),{connectionData:r}=b.useContext(O),{device:t}=K({from:"/device"}),l=W(),[o,n]=b.useState({});if(!r||!t)throw new Error("Missing data");const{mutate:x,isPending:c}=te({mutationFn:async m=>{const u=await se({client:r.client,requestTopic:t.requestTopic,responseTopic:t.responseTopic,action:s.name,parameters:m});if(u.status===I.ERROR)throw new Error(u.code);return console.log("res",u.results),u.results},onSuccess(m){n(m),M(a("actionSuccess"),{indicator:e.jsx(de,{}),variant:"success"})},onError(m){M(`${a("error")}: ${m.code}`,{indicator:e.jsx(xe,{}),variant:"danger"})}});return e.jsxs(e.Fragment,{children:[s.parameters&&s.parameters.length?e.jsx(fe,{state:l,action:s,onSubmit:m=>{x(m),l.close()}}):null,e.jsx(p,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(p.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(H,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsx(q,{isIconOnly:!0,variant:"primary",isPending:c,style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 30%) 0 0 3rem 0"},onPress:()=>{s.parameters&&s.parameters.length?l.open():x({})},children:e.jsx(Q,{})})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(me,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:a("parameters")})]}),e.jsx(F,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.parameters&&s.parameters.length?s.parameters.map((m,u)=>e.jsx(L,{value:m},`${m.name}-${u}`)):e.jsx(P,{})}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(_,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:a("results")})]}),e.jsx(F,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results&&s.results.length?s.results.map((m,u)=>e.jsx(L,{value:m,valueData:o[m.name]},`${m.name}-${u}`)):e.jsx(P,{})})]})})]})}function A(){const{t:s}=f();return e.jsxs("div",{className:"flex flex-col gap-[1rem] items-center py-[3rem]",children:[e.jsx("img",{src:le,alt:"empty",className:"h-[10rem]"}),e.jsx("div",{className:"flex uppercase font-bold text-[20pt]",children:s("empty")})]})}function ge(){const{t:s}=f(),{connectionData:a}=b.useContext(O),{device:r}=G.useRouteContext();if(!a||!r)throw new Error("Missing data");const{data:t,isLoading:l}=z({queryKey:["SCHEMA",r.id],queryFn:async()=>{const o=await U({client:a.client,requestTopic:r.requestTopic,responseTopic:r.responseTopic,query:"__SCHEMA__"});if(console.log("res",o),o.status===I.ERROR)throw new Error(o.code);return o.results}});return l||!t?e.jsx(ee,{}):e.jsxs(d,{className:"mt-[3rem]",children:[e.jsx(d.ListContainer,{children:e.jsxs(d.List,{"aria-label":"Options",children:[e.jsxs(d.Tab,{id:"auto-fetch",children:[s("queries"),e.jsx(d.Indicator,{})]}),e.jsxs(d.Tab,{id:"manual-fetch",children:[s("actions"),e.jsx(d.Indicator,{})]})]})}),e.jsx(d.Panel,{className:"pt-4",id:"auto-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:t.queries.length?t.queries.map((o,n)=>e.jsx(je,{query:o},`${o.name}-${n}`)):e.jsx(A,{})})}),e.jsx(d.Panel,{className:"pt-4",id:"manual-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:t.actions.length?t.actions.map((o,n)=>e.jsx(Ne,{action:o},`${o.name}-${n}`)):e.jsx(A,{})})})]})}function Oe(){const{connectionData:s}=b.useContext(O),{device:a}=G.useRouteContext();return!s||!a?e.jsx(Z,{to:"/"}):e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full px-[1rem] pb-[5rem]",children:[e.jsxs("div",{className:"flex flex-col pt-[5rem] pb-[2rem] gap-[2rem]",children:[e.jsxs("div",{className:"flex relative justify-center items-center",children:[e.jsx("img",{src:ue,alt:"chip",className:"h-[7rem] z-10"}),e.jsx("div",{className:"flex absolute h-[10rem] w-[15rem] rounded-full bg-accent blur-2xl opacity-20"})]}),e.jsx("div",{className:"flex justify-center font-bold text-[20pt] z-10",children:a.name})]}),e.jsx(p,{children:e.jsxs(p.Content,{children:[e.jsx(E,{name:"ID",value:a.id}),e.jsx(E,{name:"Request topic",value:a.requestTopic}),e.jsx(E,{name:"Response topic",value:a.responseTopic})]})}),e.jsx(ge,{})]})})}export{Oe as component};
