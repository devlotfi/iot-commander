import{j as e,e as U,r as g,x as j,D as v,B as E,E as O,M as p,F as _,y as N,L as I,z as R,G as T,H as G,t as D,I as d}from"./heroui-BBt1nr5R.js";import{u as H,b as k,R as M,N as J,D as w,L as K}from"./index-B_1Iqdah.js";import{V as l,u as h,M as y,m as F,R as q}from"./mqtt-CuWERCz6.js";import{u as W,V as b,c as P,a as Q,b as C,d as Y,e as X,E as Z}from"./validated-text-field-vnZqf9m_.js";import{b as ee,f as A,R as se,B,c as ne,P as V,V as te,I as ae,g as re}from"./lucide-react-DXqvARnK.js";function z(s){return H({...s,select:n=>s.select?s.select(n.context):n.context})}const ce="/iot-commander/assets/chip-CyMWBy1t.svg";function S({variable:s,value:n,className:a,...m}){return e.jsxs("div",{className:U("flex flex-col mb-[0.3rem] md:flex-row md:gap-[0.5rem] md:mb-0",a),...m,children:[e.jsxs("div",{className:"flex flex-1 justify-between items-center gap-[0.7rem]",children:[e.jsxs("div",{className:"flex gap-[0.5rem]",children:[e.jsxs("div",{className:"flex text-[12pt] text-accent gap-[0.5rem]",children:[e.jsxs("div",{className:"flex",children:[s.type," "]}),s.type===l.ENUM&&s.enumDefinition?e.jsxs("div",{className:"flex",children:["(",s.enumDefinition.join(", "),")"]}):null]}),e.jsx("div",{className:"flex text-[12pt] opacity-80",children:s.name})]}),e.jsx("div",{className:"flex h-[1px] flex-1 bg-separator"})]}),n?e.jsx("div",{className:"flex items-center text-[12pt] break-all",children:n}):null]})}function $(){const{t:s}=h();return e.jsxs("div",{className:"flex items-center gap-[1rem] opacity-60",children:[e.jsx(ee,{className:"size-[1.5rem]"}),e.jsx("div",{className:"flex font-medium",children:s("empty")})]})}function ie({action:s}){const{t:n}=h(),{connectionData:a}=g.useContext(y),{device:m}=z({from:"/device"});if(!a||!m)throw new Error("Missing data");const{data:i,isLoading:x,refetch:t,isRefetching:r}=k({queryKey:["ACTION_AUTO_FETCH",s.name],queryFn:async()=>{const c=await F({client:a.client,requestTopic:m.requestTopic,responseTopic:m.responseTopic,action:s.name,parameters:{}});if(c.status===q.ERROR)throw new Error(c.code);return console.log("res",c.results),c.results}});return x||!i?e.jsx(j,{children:e.jsxs(j.Content,{className:"gap-[1rem]",children:[e.jsx(v,{className:"h-3 w-1/2 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"}),e.jsx(v,{className:"h-3 rounded-lg"})]})}):e.jsx(j,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(j.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(A,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsx(E,{isIconOnly:!0,variant:"outline",className:"bg-[color-mix(in_srgb,var(--surface),transparent_80%)]",isPending:r,onPress:()=>t(),children:e.jsx(se,{})})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(B,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("results")})]}),e.jsx(O,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results.length?s.results.map((c,o)=>e.jsx(S,{variable:c,value:i[c.name]!==void 0?JSON.stringify(i[c.name]):"N/A"},`${c.name}-${o}`)):e.jsx($,{})})]})})}function le(s){const n={};for(const a of s.parameters)switch(a.type){case l.INT:n[a.name]="";break;case l.FLOAT:n[a.name]="";break;case l.DOUBLE:n[a.name]="";break;case l.BOOL:n[a.name]=!1;break;case l.STRING:n[a.name]="";break;case l.ENUM:n[a.name]="";break}return n}function oe(s){const n={};for(const a of s.parameters)switch(a.type){case l.INT:n[a.name]=C().integer().required();break;case l.FLOAT:n[a.name]=C().required();break;case l.DOUBLE:n[a.name]=C().required();break;case l.BOOL:n[a.name]=Q();break;case l.STRING:n[a.name]=P().required();break;case l.ENUM:a.enumDefinition&&(n[a.name]=P().oneOf([...a.enumDefinition]).required());break}return Y(n)}function f({parameter:s}){return e.jsxs("span",{children:[e.jsx("span",{className:"mr-[0.3rem] text-accent",children:s.type}),e.jsx("span",{children:s.name})]})}function me({state:s,action:n,onSubmit:a}){const{t:m}=h(),i=W({initialValues:le(n),validationSchema:oe(n),onSubmit(t){a(t)}});function x(){return n.parameters.map((t,r)=>{switch(t.type){case l.INT:return e.jsx(b,{formik:i,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"1"}},`${t.name}-${r}`);case l.FLOAT:return e.jsx(b,{formik:i,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"0.01"}},`${t.name}-${r}`);case l.DOUBLE:return e.jsx(b,{formik:i,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})},inputProps:{type:"number",step:"0.01"}},`${t.name}-${r}`);case l.BOOL:return e.jsxs(T,{isSelected:i.values[t.name],onChange:c=>i.setFieldValue(t.name,c),children:[e.jsx(T.Control,{children:e.jsx(T.Thumb,{})}),e.jsx(I,{className:"text-sm",children:e.jsx(f,{parameter:t})})]},`${t.name}-${r}`);case l.STRING:return e.jsx(b,{formik:i,name:t.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(f,{parameter:t})}},`${t.name}-${r}`);case l.ENUM:if(t.enumDefinition)return e.jsxs(N,{isInvalid:i.errors[t.name]!==void 0,value:i.values[t.name],onChange:c=>i.setFieldValue(t.name,c?.toString()),children:[e.jsx(I,{children:e.jsx(f,{parameter:t})}),e.jsxs(N.Trigger,{children:[e.jsx(N.Value,{}),e.jsx(N.Indicator,{})]}),e.jsx(N.Popover,{children:e.jsx(R,{children:t.enumDefinition.map(c=>e.jsxs(R.Item,{id:c,textValue:c,children:[c,e.jsx(R.ItemIndicator,{})]},c))})}),i.errors[t.name]?e.jsx("div",{className:"ml-[0.3rem] text-danger text-[9pt]",children:i.errors[t.name]}):null]},`${t.name}-${r}`)}})}return e.jsx(p.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(p.Container,{placement:"center",children:e.jsxs(p.Dialog,{children:[e.jsx(p.CloseTrigger,{}),e.jsxs(p.Header,{children:[e.jsx(p.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(ne,{name:"variable",className:"size-5"})}),e.jsx(p.Heading,{children:m("parameters")})]}),e.jsx(p.Body,{className:"p-[0.3rem]",children:e.jsxs(_,{onSubmit:i.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[x(),e.jsxs(E,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:[m("send"),e.jsx(V,{})]})]})})]})})})}function xe({action:s}){const{t:n}=h(),{connectionData:a}=g.useContext(y),{device:m}=z({from:"/device"}),i=G(),[x,t]=g.useState({});if(!a||!m)throw new Error("Missing data");const{mutate:r,isPending:c}=X({mutationFn:async o=>{const u=await F({client:a.client,requestTopic:m.requestTopic,responseTopic:m.responseTopic,action:s.name,parameters:o});if(u.status===q.ERROR)throw new Error(u.code);return console.log("res",u.results),u.results},onSuccess(o){t(o),D(n("actionSuccess"),{indicator:e.jsx(re,{}),variant:"success"})},onError(o){D(`${n("error")}: ${o.code}`,{indicator:e.jsx(ae,{}),variant:"danger"})}});return e.jsxs(e.Fragment,{children:[s.parameters.length?e.jsx(me,{state:i,action:s,onSubmit:o=>{r(o),i.close()}}):null,e.jsx(j,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(j.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[13pt] font-bold pl-[0.5rem] pb-[0.5rem]",children:[e.jsx(A,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:s.name})]}),e.jsx(E,{isIconOnly:!0,variant:"primary",isPending:c,style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 30%) 0 0 3rem 0"},onPress:()=>{s.parameters.length?i.open():r({})},children:e.jsx(V,{})})]}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(te,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("parameters")})]}),e.jsx(O,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.parameters.length?s.parameters.map((o,u)=>e.jsx(S,{variable:o},`${o.name}-${u}`)):e.jsx($,{})}),e.jsxs("div",{className:"flex items-center gap-[0.5rem] text-[11pt] pl-[0.5rem] opacity-70",children:[e.jsx(B,{className:"size-[13pt]"}),e.jsx("div",{className:"flex",children:n("results")})]}),e.jsx(O,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:s.results.length?s.results.map((o,u)=>e.jsx(S,{variable:o,value:x[o.name]?JSON.stringify(x[o.name]):"N/A"},`${o.name}-${u}`)):e.jsx($,{})})]})})]})}function L(){const{t:s}=h();return e.jsxs("div",{className:"flex flex-col gap-[1rem] items-center py-[3rem]",children:[e.jsx("img",{src:Z,alt:"empty",className:"h-[10rem]"}),e.jsx("div",{className:"flex uppercase font-bold text-[20pt]",children:s("empty")})]})}function de(){const{t:s}=h(),{connectionData:n}=g.useContext(y),{device:a}=M.useRouteContext();if(!n||!a)throw new Error("Missing data");const{data:m,isLoading:i}=k({queryKey:["SCHEMA"],queryFn:async()=>{const r=await F({client:n.client,requestTopic:a.requestTopic,responseTopic:a.responseTopic,action:"__SCHEMA__",parameters:{}});if(console.log("res",r),r.status===q.ERROR)throw new Error(r.code);return r.results.actions}});if(i||!m)return e.jsx(K,{});const x=m.filter(r=>r.autoFetch),t=m.filter(r=>!r.autoFetch);return e.jsxs(d,{className:"mt-[3rem]",children:[e.jsx(d.ListContainer,{children:e.jsxs(d.List,{"aria-label":"Options",children:[e.jsxs(d.Tab,{id:"auto-fetch",children:[s("autoFetch"),e.jsx(d.Indicator,{})]}),e.jsxs(d.Tab,{id:"manual-fetch",children:[s("manual"),e.jsx(d.Indicator,{})]})]})}),e.jsx(d.Panel,{className:"pt-4",id:"auto-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:x.length?x.map((r,c)=>e.jsx(ie,{action:r},`${r.name}-${c}`)):e.jsx(L,{})})}),e.jsx(d.Panel,{className:"pt-4",id:"manual-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:t.length?t.map((r,c)=>e.jsx(xe,{action:r},`${r.name}-${c}`)):e.jsx(L,{})})})]})}function Ne(){const{connectionData:s}=g.useContext(y),{device:n}=M.useRouteContext();return!s||!n?e.jsx(J,{to:"/"}):e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full px-[1rem] pb-[5rem]",children:[e.jsxs("div",{className:"flex flex-col pt-[5rem] pb-[2rem] gap-[2rem]",children:[e.jsxs("div",{className:"flex relative justify-center items-center",children:[e.jsx("img",{src:ce,alt:"chip",className:"h-[7rem] z-10"}),e.jsx("div",{className:"flex absolute h-[10rem] w-[15rem] rounded-full bg-accent blur-2xl opacity-20"})]}),e.jsx("div",{className:"flex justify-center font-bold text-[20pt] z-10",children:n.name})]}),e.jsx(j,{children:e.jsxs(j.Content,{children:[e.jsx(w,{name:"ID",value:n.id}),e.jsx(w,{name:"Request topic",value:n.requestTopic}),e.jsx(w,{name:"Response topic",value:n.responseTopic})]})}),e.jsx(de,{})]})})}export{Ne as component};
