import{r as j,j as e,M as r,F as S,G as g,L as F,B as d,H as C,x as D}from"./heroui-BBt1nr5R.js";import{c as P,d as O,D as N,b as z,L as E,E as k}from"./index-B_1Iqdah.js";import{e as v,u as q,d as w,c as p,V as h,E as A}from"./validated-text-field-vnZqf9m_.js";import{S as B}from"./section-header-DT5aPG68.js";import{u as y,v as M,M as H}from"./mqtt-CuWERCz6.js";import{h as T,T as R,i as I,K as V,E as L,j as U,U as K,k as _}from"./lucide-react-DXqvARnK.js";function Q({state:s}){const{t:i}=y(),{rxdb:n}=j.useContext(P),o=O(),{mutate:l,isPending:c}=v({mutationFn:async m=>{await n.connections.insert({id:M(),name:m.name,url:m.url,discoveryTopic:m.discoveryTopic,responseDiscoveryTopic:m.responseDiscoveryTopic,username:m.username}),o.resetQueries({queryKey:["CONNECTIONS"]}),s.close()}}),a=q({initialValues:{name:"",url:"",username:"",discoveryTopic:"iot-commander/discovery-topic",responseDiscoveryTopic:"iot-commander/response-discovery-topic"},validationSchema:w({name:p().required(),url:p().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid url"}).required(),username:p(),discoveryTopic:p().required(),responseDiscoveryTopic:p().required()}),onSubmit(m){l(m)}}),[t,f]=j.useState(!0);return e.jsx(r.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(r.Container,{placement:"center",children:e.jsxs(r.Dialog,{children:[e.jsx(r.CloseTrigger,{}),e.jsxs(r.Header,{children:[e.jsx(r.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(T,{className:"size-5"})}),e.jsx(r.Heading,{children:i("addConnection")})]}),e.jsx(r.Body,{className:"p-[0.3rem]",children:e.jsxs(S,{onSubmit:a.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[e.jsx(h,{formik:a,name:"name",textFieldProps:{isRequired:!0},labelProps:{children:i("name")}}),e.jsx(h,{formik:a,name:"url",textFieldProps:{isRequired:!0},labelProps:{children:"URL"}}),e.jsx(h,{formik:a,name:"discoveryTopic",textFieldProps:{isRequired:!0},labelProps:{children:"Discovery topic"}}),e.jsx(h,{formik:a,name:"responseDiscoveryTopic",textFieldProps:{isRequired:!0},labelProps:{children:"Response discovery topic"}}),e.jsxs(g,{isSelected:t,onChange:f,children:[e.jsx(g.Control,{children:e.jsx(g.Thumb,{})}),e.jsx(F,{className:"text-sm",children:i("useAuthenthication")})]}),t?e.jsx(h,{formik:a,name:"username",labelProps:{children:i("username")}}):null,e.jsx(d,{fullWidth:!0,isPending:c,type:"submit",className:"mt-[1rem]",children:i("add")})]})})]})})})}function W({state:s,connection:i}){const{t:n}=y(),{rxdb:o}=j.useContext(P),l=O(),{mutate:c,isPending:a}=v({mutationFn:async()=>{const t=await o.connections.findOne(i.id).exec();t&&(await t.remove(),l.resetQueries({queryKey:["CONNECTIONS"]}),s.close())}});return e.jsx(r.Backdrop,{variant:"blur",isOpen:s.isOpen,onOpenChange:s.setOpen,children:e.jsx(r.Container,{placement:"center",children:e.jsxs(r.Dialog,{className:"sm:max-w-[360px]",children:[e.jsx(r.CloseTrigger,{}),e.jsxs(r.Header,{children:[e.jsx(r.Icon,{className:"bg-danger-soft text-danger-soft-foreground",children:e.jsx(R,{className:"size-5"})}),e.jsx(r.Heading,{children:n("deleteConnection")})]}),e.jsx(r.Body,{children:e.jsx("div",{className:"flex",children:n("deleteConfirmation")})}),e.jsxs(r.Footer,{children:[e.jsx(d,{variant:"outline",onPress:()=>s.close(),children:n("cancel")}),e.jsx(d,{variant:"danger",isPending:a,onPress:()=>c(),children:n("delete")})]})]})})})}function $({state:s,connection:i}){const{t:n}=y(),{rxdb:o}=j.useContext(P),l=O(),{mutate:c,isPending:a}=v({mutationFn:async x=>{console.log(x);const b=await o.connections.findOne(i.id).exec();b&&(await b.incrementalModify(u=>(u.name=x.name,u.name=x.name,u.url=x.url,u.discoveryTopic=x.discoveryTopic,u.responseDiscoveryTopic=x.responseDiscoveryTopic,u.username=x.username||null,u)),l.resetQueries({queryKey:["CONNECTIONS"]}),s.close())}}),t=q({initialValues:{name:i.name,url:i.url,username:i.username||"",discoveryTopic:i.discoveryTopic,responseDiscoveryTopic:i.responseDiscoveryTopic},validationSchema:w({name:p().required(),url:p().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid url"}).required(),username:p(),discoveryTopic:p().required(),responseDiscoveryTopic:p().required()}),onSubmit(x){c(x)}}),[f,m]=j.useState(!!i.username);return e.jsx(r.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(r.Container,{placement:"center",children:e.jsxs(r.Dialog,{children:[e.jsx(r.CloseTrigger,{}),e.jsxs(r.Header,{children:[e.jsx(r.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(I,{className:"size-5"})}),e.jsx(r.Heading,{children:n("editConnection")})]}),e.jsx(r.Body,{className:"p-[0.1rem]",children:e.jsxs(S,{onSubmit:t.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[e.jsx(h,{formik:t,name:"name",textFieldProps:{isRequired:!0},labelProps:{children:n("name")}}),e.jsx(h,{formik:t,name:"url",textFieldProps:{isRequired:!0},labelProps:{children:"URL"}}),e.jsx(h,{formik:t,name:"discoveryTopic",textFieldProps:{isRequired:!0},labelProps:{children:"Discovery topic"}}),e.jsx(h,{formik:t,name:"responseDiscoveryTopic",textFieldProps:{isRequired:!0},labelProps:{children:"Response discovery topic"}}),e.jsxs(g,{isSelected:f,onChange:m,children:[e.jsx(g.Control,{children:e.jsx(g.Thumb,{})}),e.jsx(F,{className:"text-sm",children:n("useAuthenthication")})]}),f?e.jsx(h,{formik:t,name:"username",labelProps:{children:n("username")}}):null,e.jsx(d,{fullWidth:!0,isPending:a,type:"submit",className:"mt-[1rem]",children:n("edit")})]})})]})})})}function G({state:s,onSubmit:i}){const{t:n}=y(),o=q({initialValues:{password:""},validationSchema:w({password:p().required()}),onSubmit(t){i(t.password),s.close()}}),[l,c]=j.useState(!1),a=()=>c(!l);return e.jsx(r.Backdrop,{isOpen:s.isOpen,onOpenChange:s.setOpen,variant:"blur",children:e.jsx(r.Container,{placement:"center",children:e.jsxs(r.Dialog,{children:[e.jsx(r.CloseTrigger,{}),e.jsxs(r.Header,{children:[e.jsx(r.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(V,{className:"size-5"})}),e.jsx(r.Heading,{children:n("connectionAuthenthication")})]}),e.jsx(r.Body,{className:"p-[0.1rem]",children:e.jsxs(S,{onSubmit:o.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[e.jsx(h,{formik:o,name:"password",textFieldProps:{isRequired:!0},inputProps:{type:l?"text":"password"},labelProps:{children:n("password")},suffix:e.jsx(d,{isIconOnly:!0,variant:"ghost",size:"sm",onPress:a,children:l?e.jsx(L,{}):e.jsx(U,{})})}),e.jsx(d,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:n("connect")})]})})]})})})}function Z({connection:s}){const{t:i}=y(),{connectionData:n,mqttConnect:o,mqttDisconnect:l}=j.useContext(H),c=C(),a=C(),t=C(),{mutate:f,isPending:m}=v({mutationFn:async u=>{await o(s,u)}}),{mutate:x,isPending:b}=v({mutationFn:async()=>{await l()}});return e.jsxs(D,{className:"flex-row relative overflow-visible",children:[e.jsxs(D.Content,{children:[e.jsx(W,{state:a,connection:s}),e.jsx($,{state:c,connection:s}),s.username?e.jsx(G,{state:t,onSubmit:u=>f(u)}):null,e.jsxs("div",{className:"flex flex-col md:flex-row pr-[1.5rem] gap-[1rem]",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex font-bold text-[15pt] break-all",children:s.name}),e.jsx(N,{name:"URL",value:s.url}),e.jsx(N,{name:"Topic",value:s.discoveryTopic}),e.jsx(N,{name:"Response topic",value:s.responseDiscoveryTopic}),s.username?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex font-bold text-[12pt]",children:i("authenthication")}),e.jsx(N,{name:i("username"),value:s.username})]}):null]}),e.jsxs("div",{className:"flex md:flex-col gap-[0.3rem]",children:[e.jsx(d,{isIconOnly:!0,variant:"outline",className:"bg-[color-mix(in_srgb,var(--surface),transparent_80%)]",onPress:()=>c.open(),children:e.jsx(I,{})}),e.jsx(d,{isIconOnly:!0,variant:"outline",className:"bg-[color-mix(in_srgb,var(--surface),transparent_80%)] text-danger",onPress:()=>a.open(),children:e.jsx(R,{})})]})]})]}),e.jsx("div",{className:"flex items-center",children:n&&n.info.id===s.id?e.jsx(d,{isIconOnly:!0,variant:"outline",isPending:b,className:"absolute size-[2.8rem] right-0 translate-x-[50%] z-10 text-danger-soft-foreground",style:{background:"linear-gradient(to top,color-mix(in srgb, var(--accent), var(--background) 95%),color-mix(in srgb, var(--surface), var(--background) 95%))"},onPress:()=>x(),children:e.jsx(K,{className:"size-[1.3rem]"})}):e.jsx(d,{isIconOnly:!0,variant:"primary",isPending:m,isDisabled:n!=null,className:"absolute size-[2.8rem] right-0 translate-x-[50%] z-10",style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 50%) 0 0 2rem 0"},onPress:()=>{console.log("lol",s.username),s.username?(console.log("lol"),t.open()):f(void 0)},children:e.jsx(_,{className:"size-[1.3rem]"})})})]})}function ne(){const{t:s}=y(),{rxdb:i}=j.useContext(P),n=C(),{data:o,isLoading:l,isError:c}=z({queryKey:["CONNECTIONS"],queryFn:async()=>await i.connections.find().exec()});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{state:n}),e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(B,{icon:"satellite-dish",children:s("connections")}),e.jsx(d,{isIconOnly:!0,variant:"outline",className:"size-[3rem] text-foreground bg-[color-mix(in_srgb,var(--surface),transparent_85%)]",onPress:()=>n.open(),children:e.jsx(T,{className:"size-[2rem]"})})]}),l?e.jsx(E,{}):c?e.jsx(k,{}):o&&o.length?e.jsx("div",{className:"flex flex-col flex-1 mt-[0.5rem] gap-[1rem] pl-[1rem] pr-[2.5rem] pb-[5rem]",children:o.map(a=>e.jsx(Z,{connection:a},a.id))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:A,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:s("noConnections.title")}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:s("noConnections.subTitle")}),e.jsxs(d,{variant:"primary",onPress:()=>n.open(),children:[e.jsx(T,{}),s("addConnection")]})]})]})})]})}export{ne as component};
