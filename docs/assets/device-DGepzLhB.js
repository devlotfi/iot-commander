import{j as e,e as M,r as h,x as f,D as N,E as w,M as u,F as k,B as D,y as j,L as E,z as v,G as y,H as A,t as F,I as m}from"./heroui-BBt1nr5R.js";import{u as B,b as I,R as P,N as V,D as R,L as U}from"./index-J8o7AkUk.js";import{V as i,M as b,m as S,R as $}from"./mqtt-CFZJwm5b.js";import{b as H,c as _,P as z,I as G,f as J}from"./lucide-react-D_XIdIIU.js";import{u as K,V as g,c as q,a as W,b as T,d as Q,e as Y}from"./validated-text-field-DBHfn_Lg.js";function L(t){return B({...t,select:n=>t.select?t.select(n.context):n.context})}const X="/iot-commander/assets/chip-CyMWBy1t.svg";function C({variable:t,value:n,className:a,...c}){return e.jsxs("div",{className:M("flex flex-col mb-[0.3rem] md:flex-row md:gap-[0.5rem] md:mb-0",a),...c,children:[e.jsxs("div",{className:"flex flex-1 justify-between items-center gap-[0.7rem]",children:[e.jsxs("div",{className:"flex gap-[0.5rem]",children:[e.jsxs("div",{className:"flex text-[12pt] text-accent gap-[0.5rem]",children:[e.jsxs("div",{className:"flex",children:[t.type," "]}),t.type===i.ENUM&&t.enumDefinition?e.jsxs("div",{className:"flex",children:["(",t.enumDefinition.join(", "),")"]}):null]}),e.jsx("div",{className:"flex text-[12pt] opacity-80",children:t.name})]}),e.jsx("div",{className:"flex h-[1px] flex-1 bg-separator"})]}),n?e.jsx("div",{className:"flex items-center text-[12pt] break-all",children:n}):null]})}function O(){return e.jsxs("div",{className:"flex items-center gap-[1rem] opacity-70",children:[e.jsx(H,{className:"text-accent size-[1.5rem]"}),e.jsx("div",{className:"flex text-accent font-medium",children:"Empty"})]})}function Z({action:t}){const{connectionData:n}=h.useContext(b),{device:a}=L({from:"/device"});if(!n||!a)throw new Error("Missing data");const{data:c,isLoading:x}=I({queryKey:["ACTION_AUTO_FETCH",t.name],queryFn:async()=>{const s=await S({client:n.client,requestTopic:a.requestTopic,responseTopic:a.responseTopic,action:t.name,parameters:{}});if(s.status===$.ERROR)throw new Error(s.code);return console.log("res",s.results),s.results}});return x||!c?e.jsx(f,{children:e.jsxs(f.Content,{className:"gap-[1rem]",children:[e.jsx(N,{className:"h-3 w-1/2 rounded-lg"}),e.jsx(N,{className:"h-3 rounded-lg"}),e.jsx(N,{className:"h-3 rounded-lg"}),e.jsx(N,{className:"h-3 rounded-lg"})]})}):e.jsx(f,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(f.Content,{children:[e.jsx("div",{className:"flex text-[13pt] font-bold",children:t.name}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Results"}),e.jsx(w,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:t.results.length?t.results.map((s,r)=>e.jsx(C,{variable:s,value:c[s.name]!==void 0?JSON.stringify(c[s.name]):"N/A"},`${s.name}-${r}`)):e.jsx(O,{})})]})})}function ee(t){const n={};for(const a of t.parameters)switch(a.type){case i.INT:n[a.name]="";break;case i.FLOAT:n[a.name]="";break;case i.DOUBLE:n[a.name]="";break;case i.BOOL:n[a.name]=!1;break;case i.STRING:n[a.name]="";break;case i.ENUM:n[a.name]="";break}return n}function se(t){const n={};for(const a of t.parameters)switch(a.type){case i.INT:n[a.name]=T().integer().required();break;case i.FLOAT:n[a.name]=T().required();break;case i.DOUBLE:n[a.name]=T().required();break;case i.BOOL:n[a.name]=W();break;case i.STRING:n[a.name]=q().required();break;case i.ENUM:a.enumDefinition&&(n[a.name]=q().oneOf([...a.enumDefinition]).required());break}return Q(n)}function p({parameter:t}){return e.jsxs("span",{children:[e.jsx("span",{className:"mr-[0.3rem] text-accent",children:t.type}),e.jsx("span",{children:t.name})]})}function ne({state:t,action:n,onSubmit:a}){const c=K({initialValues:ee(n),validationSchema:se(n),onSubmit(s){a(s)}});function x(){return n.parameters.map((s,r)=>{switch(s.type){case i.INT:return e.jsx(g,{formik:c,name:s.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(p,{parameter:s})},inputProps:{type:"number",step:"1"}},`${s.name}-${r}`);case i.FLOAT:return e.jsx(g,{formik:c,name:s.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(p,{parameter:s})},inputProps:{type:"number",step:"0.01"}},`${s.name}-${r}`);case i.DOUBLE:return e.jsx(g,{formik:c,name:s.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(p,{parameter:s})},inputProps:{type:"number",step:"0.01"}},`${s.name}-${r}`);case i.BOOL:return e.jsxs(y,{isSelected:c.values[s.name],onChange:o=>c.setFieldValue(s.name,o),children:[e.jsx(y.Control,{children:e.jsx(y.Thumb,{})}),e.jsx(E,{className:"text-sm",children:e.jsx(p,{parameter:s})})]},`${s.name}-${r}`);case i.STRING:return e.jsx(g,{formik:c,name:s.name,textFieldProps:{isRequired:!0},labelProps:{children:e.jsx(p,{parameter:s})}},`${s.name}-${r}`);case i.ENUM:if(s.enumDefinition)return e.jsxs(j,{isInvalid:c.errors[s.name]!==void 0,value:c.values[s.name],onChange:o=>c.setFieldValue(s.name,o?.toString()),children:[e.jsx(E,{children:e.jsx(p,{parameter:s})}),e.jsxs(j.Trigger,{children:[e.jsx(j.Value,{}),e.jsx(j.Indicator,{})]}),e.jsx(j.Popover,{children:e.jsx(v,{children:s.enumDefinition.map(o=>e.jsxs(v.Item,{id:o,textValue:o,children:[o,e.jsx(v.ItemIndicator,{})]},o))})}),c.errors[s.name]?e.jsx("div",{className:"ml-[0.3rem] text-danger text-[9pt]",children:c.errors[s.name]}):null]},`${s.name}-${r}`)}})}return e.jsx(u.Backdrop,{isOpen:t.isOpen,onOpenChange:t.setOpen,variant:"blur",children:e.jsx(u.Container,{placement:"center",children:e.jsxs(u.Dialog,{children:[e.jsx(u.CloseTrigger,{}),e.jsxs(u.Header,{children:[e.jsx(u.Icon,{className:"bg-accent-soft text-accent-soft-foreground",children:e.jsx(_,{name:"variable",className:"size-5"})}),e.jsx(u.Heading,{children:"Parameters"})]}),e.jsx(u.Body,{className:"p-[0.3rem]",children:e.jsxs(k,{onSubmit:c.handleSubmit,className:"flex flex-col gap-[0.5rem]",children:[x(),e.jsx(D,{fullWidth:!0,type:"submit",className:"mt-[1rem]",children:"Request"})]})})]})})})}function te({action:t}){const{connectionData:n}=h.useContext(b),{device:a}=L({from:"/device"}),c=A(),[x,s]=h.useState({});if(!n||!a)throw new Error("Missing data");const{mutate:r,isPending:o}=Y({mutationFn:async l=>{const d=await S({client:n.client,requestTopic:a.requestTopic,responseTopic:a.responseTopic,action:t.name,parameters:l});if(d.status===$.ERROR)throw new Error(d.code);return console.log("res",d.results),d.results},onSuccess(l){s(l),F("Action successful",{indicator:e.jsx(J,{}),variant:"success"})},onError(l){F(`Error: ${l.code}`,{indicator:e.jsx(G,{}),variant:"danger"})}});return e.jsxs(e.Fragment,{children:[t.parameters.length?e.jsx(ne,{state:c,action:t,onSubmit:l=>{r(l),c.close()}}):null,e.jsx(f,{className:"p-[0.5rem] md:p-[1rem]",children:e.jsxs(f.Content,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex text-[13pt] font-bold pb-[1rem]",children:t.name}),e.jsx(D,{isIconOnly:!0,variant:"primary",isPending:o,style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 30%) 0 0 3rem 0"},onPress:()=>{t.parameters.length?c.open():r({})},children:e.jsx(z,{})})]}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Parameters"}),e.jsx(w,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:t.parameters.length?t.parameters.map((l,d)=>e.jsx(C,{variable:l},`${l.name}-${d}`)):e.jsx(O,{})}),e.jsx("div",{className:"flex text-[12pt] font-medium opacity-70",children:"Results"}),e.jsx(w,{className:"flex flex-col gap-[0.5rem] p-[0.5rem]",children:t.results.length?t.results.map((l,d)=>e.jsx(C,{variable:l,value:x[l.name]?JSON.stringify(x[l.name]):"N/A"},`${l.name}-${d}`)):e.jsx(O,{})})]})})]})}function ae(){const{connectionData:t}=h.useContext(b),{device:n}=P.useRouteContext();if(!t||!n)throw new Error("Missing data");const{data:a,isLoading:c}=I({queryKey:["SCHEMA"],queryFn:async()=>{const r=await S({client:t.client,requestTopic:n.requestTopic,responseTopic:n.responseTopic,action:"__SCHEMA__",parameters:{}});if(console.log("res",r),r.status===$.ERROR)throw new Error(r.code);return r.results.actions}});if(c||!a)return e.jsx(U,{});const x=a.filter(r=>r.autoFetch),s=a.filter(r=>!r.autoFetch);return e.jsxs(m,{className:"mt-[3rem]",children:[e.jsx(m.ListContainer,{children:e.jsxs(m.List,{"aria-label":"Options",children:[e.jsxs(m.Tab,{id:"auto-fetch",children:["Auto-fetch",e.jsx(m.Indicator,{})]}),e.jsxs(m.Tab,{id:"manual-fetch",children:["Manual",e.jsx(m.Indicator,{})]})]})}),e.jsx(m.Panel,{className:"pt-4",id:"auto-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:x.map((r,o)=>e.jsx(Z,{action:r},`${r.name}-${o}`))})}),e.jsx(m.Panel,{className:"pt-4",id:"manual-fetch",children:e.jsx("div",{className:"flex flex-col gap-[1rem]",children:s.map((r,o)=>e.jsx(te,{action:r},`${r.name}-${o}`))})})]})}function me(){const{connectionData:t}=h.useContext(b),{device:n}=P.useRouteContext();return!t||!n?e.jsx(V,{to:"/"}):e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full px-[1rem] pb-[5rem]",children:[e.jsxs("div",{className:"flex flex-col pt-[5rem] pb-[2rem] gap-[2rem]",children:[e.jsxs("div",{className:"flex relative justify-center items-center",children:[e.jsx("img",{src:X,alt:"chip",className:"h-[7rem] z-10"}),e.jsx("div",{className:"flex absolute h-[10rem] w-[15rem] rounded-full bg-accent blur-2xl opacity-20"})]}),e.jsx("div",{className:"flex justify-center font-bold text-[20pt] z-10",style:{fontFamily:"Doto"},children:n.name})]}),e.jsx(f,{children:e.jsxs(f.Content,{children:[e.jsx(R,{name:"ID",value:n.id}),e.jsx(R,{name:"Request topic",value:n.requestTopic}),e.jsx(R,{name:"Response topic",value:n.responseTopic})]})}),e.jsx(ae,{})]})})}export{me as component};
