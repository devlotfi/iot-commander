import{j as e,x as o,C as f,r as i,B as y,v as N}from"./heroui-BBt1nr5R.js";import{i as b,j as u,D as p}from"./index-J8o7AkUk.js";import{u as j,M as h,v as C,c as D}from"./mqtt-CFZJwm5b.js";import{S}from"./section-header-BJ9Nj6aX.js";import{G as T,j as w}from"./lucide-react-D_XIdIIU.js";const E="/iot-commander/assets/server-UBdGvH3o.svg",R="/iot-commander/assets/search-CfZjZxyt.svg";function d({device:n}){const s=b(),r=u();return e.jsxs(o,{className:"hover:border-accent cursor-pointer duration-200 transition-colors",onClick:()=>{s.update({context:{device:n}}),r({to:"/device"})},children:[e.jsxs(o.Header,{className:"flex-row justify-between items-center",children:[e.jsx(o.Title,{children:n.name}),e.jsxs(f,{color:"success",children:[e.jsx(f.Label,{children:"Online"}),e.jsx(T,{className:"size-[1rem]"})]})]}),e.jsxs(o.Content,{children:[e.jsx(p,{name:"ID",value:n.id,fold:!0}),e.jsx(p,{name:"Request topic",value:n.requestTopic,fold:!0}),e.jsx(p,{name:"Response topic",value:n.responseTopic,fold:!0})]})]})}function $(){const{t:n}=j(),{connectionData:s}=i.useContext(h);if(!s)throw new Error("No connection");const[r,v]=i.useState([]);return i.useEffect(()=>{s.client.subscribe(s.info.responseDiscoveryTopic);const t=(c,g)=>{try{const a=g.toString(),l=JSON.parse(a);console.log(l),v(m=>m.find(x=>x.id===l.id)?m:[...m.map(x=>({...x})),l])}catch(a){console.error(a)}};return s.client.on("message",t),()=>{s.client.removeListener("message",t),s.client.unsubscribe(s.info.responseDiscoveryTopic)}},[s.client,s.info.responseDiscoveryTopic]),i.useEffect(()=>{const t={requestId:C(),type:D.REQUEST,action:"__DISCOVERY__",parameters:{}};s.client.publish(s.info.discoveryTopic,JSON.stringify(t))},[s.client,s.info.discoveryTopic]),e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[2rem]",children:[e.jsx(S,{icon:"cpu",children:n("devices")}),e.jsx(N,{color:"accent",size:"lg"})]}),r.length?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-[1rem] p-[1rem] pb-[5rem]",children:[r.map((t,c)=>e.jsx(d,{device:t},`${t.id}-${c}`)),r.map((t,c)=>e.jsx(d,{device:t},`${t.id}-${c}`)),r.map((t,c)=>e.jsx(d,{device:t},`${t.id}-${c}`))]}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:R,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold uppercase",style:{fontFamily:"Doto"},children:"Searching..."})]})]})})}function z(){const{t:n}=j(),{connectionData:s}=i.useContext(h),r=u();return s?e.jsx($,{}):e.jsx("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[1rem]",children:e.jsxs(o,{children:[e.jsxs(o.Content,{className:"text-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:E,alt:"device",className:"h-[12rem] md:h-[12rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold uppercase",style:{fontFamily:"Doto"},children:n("disconnected")}),e.jsx("div",{className:"flex text-[13pt] opacity-85",children:n("noConnections.subTitle")})]}),e.jsx(o.Footer,{className:"justify-center",children:e.jsxs(y,{variant:"primary",onPress:()=>r({to:"/connections"}),children:[e.jsx(w,{}),n("connect")]})})]})})}export{z as component};
