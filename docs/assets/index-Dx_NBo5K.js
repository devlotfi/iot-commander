import{j as e,x as n,C as f,r as o,B as g,v as N}from"./heroui-CxA_KB6w.js";import{i as y,j,D as d}from"./index-kUqcAhhm.js";import{u as p,M as h,v as b}from"./mqtt-CQkWiMLD.js";import{S}from"./section-header-mv7lelb8.js";import{G as C,k as D}from"./lucide-react-DOKIJRMn.js";const w="/iot-commander/assets/server-B_3goRKR.svg",T="/iot-commander/assets/search-GWH5Hsyp.svg";function R({device:t}){const{t:s}=p(),c=y(),i=j();return e.jsxs(n,{className:"hover:border-accent cursor-pointer duration-200 transition-colors",onClick:()=>{c.update({context:{device:t}}),i({to:"/device"})},children:[e.jsxs(n.Header,{className:"flex-row justify-between items-center",children:[e.jsx(n.Title,{children:t.name}),e.jsxs(f,{color:"success",children:[e.jsx(f.Label,{children:s("online")}),e.jsx(C,{className:"size-[1rem]"})]})]}),e.jsxs(n.Content,{children:[e.jsx(d,{name:"ID",value:t.id,fold:!0}),e.jsx(d,{name:"Request topic",value:t.requestTopic,fold:!0}),e.jsx(d,{name:"Response topic",value:t.responseTopic,fold:!0})]})]})}function q(){const{t}=p(),{connectionData:s}=o.useContext(h);if(!s)throw new Error("No connection");const[c,i]=o.useState([]);return o.useEffect(()=>{s.client.subscribe(s.info.responseDiscoveryTopic);const r=(u,v)=>{try{const a=v.toString(),l=JSON.parse(a);console.log(l),i(m=>m.find(x=>x.id===l.id)?m:[...m.map(x=>({...x})),l])}catch(a){console.error(a)}};return s.client.on("message",r),()=>{s.client.removeListener("message",r),s.client.unsubscribe(s.info.responseDiscoveryTopic)}},[s.client,s.info.responseDiscoveryTopic]),o.useEffect(()=>{const r={requestId:b(),query:"__DISCOVERY__"};s.client.publish(s.info.discoveryTopic,JSON.stringify(r))},[s.client,s.info.discoveryTopic]),e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[2rem]",children:[e.jsx(S,{icon:"cpu",children:t("devices")}),e.jsx(N,{color:"accent",size:"lg"})]}),c.length?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-[1rem] p-[1rem] pb-[5rem]",children:c.map((r,u)=>e.jsx(R,{device:r},`${r.id}-${u}`))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:T,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsxs("div",{className:"flex text-[18pt] font-bold uppercase",children:[t("searching"),"..."]})]})]})})}function z(){const{t}=p(),{connectionData:s}=o.useContext(h),c=j();return s?e.jsx(q,{}):e.jsx("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[1rem]",children:e.jsxs(n,{className:"max-w-md w-full",children:[e.jsxs(n.Content,{className:"text-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:w,alt:"server",className:"h-[12rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold uppercase",children:t("disconnected")}),e.jsx("div",{className:"flex text-[13pt] opacity-85",children:t("connectToMqtt")})]}),e.jsx(n.Footer,{className:"justify-center py-[0.5rem]",children:e.jsxs(g,{variant:"primary",style:{boxShadow:"color-mix(in srgb, var(--accent), transparent 50%) 0 0 2rem 0"},onPress:()=>c({to:"/connections"}),children:[e.jsx(D,{}),t("connect")]})})]})})}export{z as component};
